services:
  - type: web
    name: whodunnitbro
    env: python
    plan: free

    buildCommand: |
      echo "---- Installing Python dependencies ----"
      pip install -r requirements.txt

      echo "---- Building C++ Engine ----"
      cd backend/cpp_engine
      mkdir -p build
      cd build
      cmake -DPython_EXECUTABLE=$(python3 -c "import sys; print(sys.executable)") ..
      make -j4

      echo "---- Copying compiled engine (.so file) ----"
      cp build/*.so ../../python_api/ || cp *.so ../../python_api/

    startCommand: python backend/python_api/app.py
